import nmap
from vulners import Vulners, VulnersApi
import os

def scan(target_ip):
    scanner = nmap.PortScanner()
    scanner.scan(hosts=target_ip, arguments='')

    vulners_api = VulnersApi(api_key='ZDOJ83SR8VQGKOKFBC3OZEREJS8VLMX29MHW1OJWDDCCERHBOOX8L0Q8MWC2L97E')

    for host in scanner.all_hosts():
        print('----------------------------------------------------')
        print(f'Host : {host} ({scanner[host].hostname()})')
        print('State :', scanner[host].state())

        # Check for common misconfigurations and outdated software versions
        os.system(f'nmap -A --script vuln {host}')

        for proto in scanner[host].all_protocols():
            print('----------')
            print(f'Protocol : {proto}')

            ports = scanner[host][proto].keys()
            for port in ports:
                port_info = scanner[host][proto][port]
                print(f'Port : {port}\tState : {port_info["state"]}\tService : {port_info["name"]}')

                # Check for vulnerabilities
                if port_info["state"] == 'open':
                    service_info = f"{port_info['name']} {port_info['version']}"
                    print(service_info)
                    vulns = vulners_api.get_software_vulnerabilities(service_info)
                    if vulns:
                        print("Vulnerabilities:")
                        for vuln in vulns:
                            print(f"\t- {vuln['title']} ({vuln['id']})")

if __name__ == "__main__":
    target_ip = input("Enter the target IP address: ")
    scan(target_ip)